<div class="mt-10 sm:mt-0">
  <div class="md:grid md:grid-cols-3 md:gap-6">
    <div class="mt-5 md:mt-0 md:col-span-3">
      <%= form_with(model: facility) do |form| %>
        <div class="shadow overflow-hidden sm:rounded-md">
          <div class="px-4 py-5 bg-white sm:p-6">
            <div class="grid grid-cols-6 gap-6">
              <div class="col-span-6 sm:col-span-3">
                <%= form.label :kind, "Type", class: "block text-sm font-medium text-gray-700" %>
                <%= form.select("kind", Facility.kinds.values , {}, onChange: "removeCHCSelect()", required: true, class: "mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm")%>
              </div>
              <div class="col-span-6 sm:col-span-3">
                <%= form.label :name, class: "block text-sm font-medium text-gray-700" %>
                <%= form.text_field :name, required: true, class: "mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
              </div>
              <div class="col-span-6 sm:col-span-3">
                <%= form.label :state, class: "block text-sm font-medium text-gray-700" %>
                <%= form.select("state_id", State.all.map { |state| [state.name, state.id] }, {selected: State.find_by(name: "Kerala").id}, { onChange: "getDistrictOptionsAndEnableSelect()", required: true, class: "mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})%>
              </div>
              <div class="col-span-6 sm:col-span-3">
                <%= form.label :district, class: "block text-sm font-medium text-gray-700" %>
                <%= form.select("district_id", State.find_by(name: "Kerala").districts.map { |district| [district.name, district.id] }, {selected: District.find_by(name: "Ernakulam").id}, required: true, class: "mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm")%>
              </div>
              <div class="col-span-6 sm:col-span-3">
                <%= form.label :lsg_body_id, class: "block text-sm font-medium text-gray-700" %>
                <%=
                  form.select(
                    'lsg_body_id',
                    lsg_body.map { |body| [body.name, body.id] },
                    {},
                    onChange: 'getWardOptionsAndEnableSelect()',
                    required: true,
                    class:
                      'mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md',
                  )
                %>
              </div>
              <div class="col-span-6 sm:col-span-3">
                <%= form.label :ward_id, class: "block text-sm font-medium text-gray-700" %>
                <%=
                  form.select(
                    'ward_id',
                    ward.map { |body| [body.number, body.id] },
                    {},
                    required: true,
                    class:
                      'mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md',
                  )
                %>
              </div>
              <div class="col-span-6">
                <%= form.label :address, class: "block text-sm font-medium text-gray-700" %>
                <%= form.text_area :address, required: true, class: "mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"%>
              </div>
              <div class="col-span-6 sm:col-span-3">
                <%= form.label :pincode, class: "block text-sm font-medium text-gray-700" %>
                <%= form.number_field :pincode, required: true, class: "mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
              </div>
              <div class="col-span-6 sm:col-span-3">
                <%= form.label :phone, class: "block text-sm font-medium text-gray-700" %>
                <%= form.telephone_field :phone, required: true, class: "mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
              </div>
              <div class="col-span-6 sm:col-span-3" id="remove_this_div">
                <%= form.label :parent_id, "Link CHC", class: "block text-sm font-medium text-gray-700" %>
                <%=
                  form.select(
                    'parent_id',
                    secondary_facilities.map { |body| [body.name, body.id] },
                    {},
                    class:
                      'mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md',
                  )
                %>
              </div>
            </div>
          </div>
          <div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
            <%= form.submit class: "inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"%>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
<script>
  let removeCHCSelect = () => {
    let value = document.getElementById("facility_kind").value;
    if (value === "CHC") {
      document.getElementById("remove_this_div").style.display = "none";
      document
        .getElementById("facility_parent_id")
        .setAttribute("disabled", "disabled");
    } else if (value === "Hospital") {
      document
        .getElementById("facility_parent_id")
        .setAttribute("disabled", "disabled");
      document.getElementById("remove_this_div").style.display = "none";
    } else {
      document.getElementById("facility_parent_id").removeAttribute("disabled");
      document.getElementById("remove_this_div").style.display = "block";
    }
  };
  removeCHCSelect();

  let getDistrictOptionsAndEnableSelect = () => {
    let value = document.getElementById("facility_state_id").value;
    let district = document.getElementById("facility_district_id");
    if (value) {
      district.removeAttribute("disabled");
      district.className =
        "mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm";
      Rails.ajax({
        type: "GET",
        url: `districts_of_state/${value}`,
        success: function (districts) {
          district.innerHTML = "";
          const districtHTML = districts.map(
            (district) =>
              `<option value=${district.id}>${district.name}</option>`
          );
          const districtOptions = districtHTML.join("\n");
          district.innerHTML = districtOptions;
        },
      });
    } else {
      district.setAttribute("disabled", "disabled");
      district.value = "";
      district.className =
        "mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm";
    }
  };
  getDistrictOptionsAndEnableSelect();

  let getWardOptionsAndEnableSelect = () => {
    let value = document.getElementById("facility_lsg_body_id").value;
    let ward = document.getElementById("facility_ward_id");
    if (value) {
      ward.removeAttribute("disabled");
      ward.className =
        "mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm";
      Rails.ajax({
        type: "GET",
        url: `wards_of_lsg_body/${value}`,
        success: function (wards) {
          ward.innerHTML = "";
          const wardHTML = wards.map(
            (ward) => `<option value=${ward.id}>${ward.number}</option>`
          );
          const wardOptions = wardHTML.join("\n");
          ward.innerHTML = wardOptions;
        },
      });
    } else {
      ward.setAttribute("disabled", "disabled");
      ward.value = "";
      ward.className =
        "mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm";
    }
  };
  getWardOptionsAndEnableSelect();
</script>
